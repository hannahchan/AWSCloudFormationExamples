{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "A VPC with a public and private subnet in a single availability zone.",
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Parameters": [
                        "AvailabilityZone",
                        "VpcCidrBlock",
                        "PublicSubnetCidrBlock",
                        "PrivateSubnetCidrBlock",
                        "IncludeNat"
                    ]
                }
            ],
            "ParameterLabels": {
                "AvailabilityZone": {
                    "default": "Availability Zone"
                },
                "VpcCidrBlock": {
                    "default": "VPC IPv4 CIDR Block"
                },
                "PublicSubnetCidrBlock": {
                    "default": "Public Subnet IPv4 CIDR Block"
                },
                "PrivateSubnetCidrBlock": {
                    "default": "Private Subnet IPv4 CIDR Block"
                },
                "IncludeNat": {
                    "default": "Include NAT Gateway"
                }
            }
        }
    },
    "Parameters": {
        "AvailabilityZone": {
            "Type": "AWS::EC2::AvailabilityZone::Name",
            "Description": "The Availability Zone for the public and private subnet."
        },
        "VpcCidrBlock": {
            "Type": "String",
            "Default": "192.168.0.0/16",
            "Description": "The IPv4 CIDR block to be used for the VPC."
        },
        "PublicSubnetCidrBlock": {
            "Type": "String",
            "Default": "192.168.0.0/24",
            "Description": "The IPv4 CIDR block to be used for the public subnet."
        },
        "PrivateSubnetCidrBlock": {
            "Type": "String",
            "Default": "192.168.1.0/24",
            "Description": "The IPv4 CIDR block to be used for the private subnet."
        },
        "IncludeNat": {
            "Type": "String",
            "Default": "false",
            "AllowedValues": [
                "true",
                "false"
            ],
            "Description": "Includes a NAT gateway if set to 'true'."
        }
    },
    "Conditions": {
        "CreateNatGateway": {
            "Fn::Equals": [
                {
                    "Ref": "IncludeNat"
                },
                "true"
            ]
        }
    },
    "Resources": {
        "Vpc": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock": {
                    "Ref": "VpcCidrBlock"
                },
                "EnableDnsSupport": true,
                "EnableDnsHostnames": true,
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Ref": "AWS::StackName"
                        }
                    }
                ]
            }
        },
        "InternetGateway": {
            "Type": "AWS::EC2::InternetGateway",
            "Properties": {}
        },
        "InternetGatewayAttachment": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "Properties": {
                "InternetGatewayId": {
                    "Ref": "InternetGateway"
                },
                "VpcId": {
                    "Ref": "Vpc"
                }
            }
        },
        "PublicSubnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "AvailabilityZone": {
                    "Ref": "AvailabilityZone"
                },
                "CidrBlock": {
                    "Ref": "PublicSubnetCidrBlock"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                " - ",
                                [
                                    {
                                        "Fn::Sub": "${AWS::StackName}"
                                    },
                                    "Public Subnet"
                                ]
                            ]
                        }
                    }
                ],
                "VpcId": {
                    "Ref": "Vpc"
                }
            }
        },
        "PublicSubnetRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                " - ",
                                [
                                    {
                                        "Fn::Sub": "${AWS::StackName}"
                                    },
                                    "Public Subnet Route Table"
                                ]
                            ]
                        }
                    }
                ],
                "VpcId": {
                    "Ref": "Vpc"
                }
            }
        },
        "PublicSubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PublicSubnetRouteTable"
                },
                "SubnetId": {
                    "Ref": "PublicSubnet"
                }
            }
        },
        "InternetGatewayRoute": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PublicSubnetRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "GatewayId": {
                    "Ref": "InternetGateway"
                }
            }
        },
        "PrivateSubnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "AvailabilityZone": {
                    "Ref": "AvailabilityZone"
                },
                "CidrBlock": {
                    "Ref": "PrivateSubnetCidrBlock"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                " - ",
                                [
                                    {
                                        "Fn::Sub": "${AWS::StackName}"
                                    },
                                    "Private Subnet"
                                ]
                            ]
                        }
                    }
                ],
                "VpcId": {
                    "Ref": "Vpc"
                }
            }
        },
        "PrivateSubnetRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                " - ",
                                [
                                    {
                                        "Fn::Sub": "${AWS::StackName}"
                                    },
                                    "Private Subnet Route Table"
                                ]
                            ]
                        }
                    }
                ],
                "VpcId": {
                    "Ref": "Vpc"
                }
            }
        },
        "PrivateSubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PrivateSubnetRouteTable"
                },
                "SubnetId": {
                    "Ref": "PrivateSubnet"
                }
            }
        },
        "NatElasticIp": {
            "Type": "AWS::EC2::EIP",
            "Condition": "CreateNatGateway"
        },
        "NatGateway": {
            "Type": "AWS::EC2::NatGateway",
            "Condition": "CreateNatGateway",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "NatElasticIp",
                        "AllocationId"
                    ]
                },
                "SubnetId": {
                    "Ref": "PublicSubnet"
                }
            }
        },
        "NatGatewayRoute": {
            "Type": "AWS::EC2::Route",
            "Condition": "CreateNatGateway",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PrivateSubnetRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "NatGatewayId": {
                    "Ref": "NatGateway"
                }
            }
        }
    },
    "Outputs": {
        "Id": {
            "Description": "The resource ID of the VPC.",
            "Value": {
                "Ref": "Vpc"
            }
        },
        "DefaultNetworkAcl": {
            "Description": "The default Network ACL ID of the VPC.",
            "Value": {
                "Fn::GetAtt": [
                    "Vpc",
                    "DefaultNetworkAcl"
                ]
            }
        },
        "DefaultSecurityGroup": {
            "Description": "The default Security Group ID of the VPC.",
            "Value": {
                "Fn::GetAtt": [
                    "Vpc",
                    "DefaultSecurityGroup"
                ]
            }
        },
        "PublicSubnetId": {
            "Description": "The resource ID of the public subnet.",
            "Value": {
                "Ref": "PublicSubnet"
            }
        },
        "PrivateSubnetId": {
            "Description": "The resource ID of the private subnet.",
            "Value": {
                "Ref": "PrivateSubnet"
            }
        }
    }
}
